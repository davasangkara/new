<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Struk Alfamart – Builder</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root{
      --w:420px;
      --muted:#7b7b7b;
      --line:#e1e1e1;
      --accent:#f4a300;

      /* Garis putus “---- ----” (utama) */
      --dash:5;
      --gap:5;

      /* Garis mini antar item */
      --mdash:12;
      --mgap:7;

      /* Garis titik tebal (info bawah) */
      --dot:3;
      --dotgap:5;

      /* Garis “= = = =” */
      --eq-seg:3px;
      --eq-gap:5px;
      --eq-line-gap:4px;
      --eq-thick:1px;
      --eq-color:#dcdcdc;
    }

    *{box-sizing:border-box;}
    body{
      margin:0; padding:16px; background:#f6f7f8; color:#222;
      font-family:"Inter", system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      font-variant-numeric:tabular-nums;
    }
    .wrap{max-width:var(--w); margin:0 auto; display:grid; gap:14px;}

    /* ====== PANEL INPUT ====== */
    .builder{ background:#fff; border-radius:14px; padding:14px; box-shadow:0 1px 6px rgba(0,0,0,.06); }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row>*{ flex:1 1 180px; }
    label{ color:#333; font-size:.9rem; display:block; margin-bottom:6px; }
    input, select{ width:100%; padding:.55rem .65rem; border:1px solid #d7d7d7; border-radius:10px; font:inherit; }
    input:focus, select:focus{ outline:0; border-color:#111 }
    .btn{ border:0; background:#111; color:#fff; padding:.55rem .9rem; border-radius:999px; cursor:pointer }
    .btn.secondary{ background:#eee; color:#111 }
    .btn.danger{ background:#d33 }

    /* ====== STRUK ====== */
    .receipt{ background:#fff; border-radius:14px; box-shadow:0 1px 6px rgba(0,0,0,.06) }
    .rcp{ padding:20px 16px 28px }
    .logo{text-align:center;margin-bottom:6px}
    .logo img{ height:76px; object-fit:contain; max-width:100% }
    .muted{ color:var(--muted) }
    .right{ text-align:right }
    .center{ text-align:center }

    /* Garis putus (utama) */
    .rule{
      width:100%; height:1px; margin:10px 0;
      background:
        linear-gradient(
          to right,
          var(--line) 0 calc(var(--dash)*1px),
          transparent 0 calc((var(--dash) + var(--gap))*1px)
        );
      background-size: calc((var(--dash) + var(--gap))*1px) 1px;
      background-repeat: repeat-x;
      background-position: left center;
    }
    /* Garis mini antar item */
    .rule--mini{
      width:100%; height:1px; margin:6px 0;
      background:
        linear-gradient(
          to right,
          var(--line) 0 calc(var(--mdash)*1px),
          transparent 0 calc((var(--mdash) + var(--mgap))*1px)
        );
      background-size: calc((var(--mdash) + var(--mgap))*1px) 1px;
      background-repeat: repeat-x;
      background-position: left center;
      opacity:.9;
    }
    /* Garis titik tebal (bawah) */
    .rule-strong{
      width:100%; height:2px; margin:12px 0;
      background:
        linear-gradient(
          to right,
          var(--line) 0 calc(var(--dot)*1px),
          transparent 0 calc((var(--dot) + var(--dotgap))*1px)
        );
      background-size: calc((var(--dot) + var(--dotgap))*1px) 2px;
      background-repeat: repeat-x;
      background-position: left center;
    }
    /* Garis “= = = =” */
    .rule-equals{
      position:relative;
      width:100%;
      height:calc((var(--eq-thick)*2) + var(--eq-line-gap));
      margin:10px 0;
      background-image:
        repeating-linear-gradient(
          to right,
          var(--eq-color) 0 var(--eq-seg),
          transparent var(--eq-seg) calc(var(--eq-seg) + var(--eq-gap))
        ),
        repeating-linear-gradient(
          to right,
          var(--eq-color) 0 var(--eq-seg),
          transparent var(--eq-seg) calc(var(--eq-seg) + var(--eq-gap))
        );
      background-repeat: repeat-x, repeat-x;
      background-size: auto var(--eq-thick), auto var(--eq-thick);
      background-position: left 0, left calc(100% - var(--eq-thick));
    }
    /* Garis solid tipis paling bawah */
    .rule-solid{ width:100%; height:1px; margin:10px 0; background: var(--line); }

    .hdr-line{ display:flex; align-items:flex-start; justify-content:space-between; gap:8px; font-size:.95rem }
    .hdr-line .left{ min-width:110px }
    .hdr-line .right{ flex:1; text-align:right }

    table{ width:100%; border-collapse:collapse; font-size:.97rem }
    th,td{ padding:6px 0; vertical-align:top }
    thead th{ color:#666; font-weight:400 }
    .name{ width:58% }
    .qty{ width:8%; text-align:right }
    .price{ width:14%; text-align:right }
    .total{ width:20%; text-align:right }

    .sum td{ padding:6px 0 }
    .sum .lbl{ width:60% }
    .sum .qty{ width:8%; text-align:right }
    .sum .amt{ width:32%; text-align:right; font-weight:500 }

    /* L U N A S – tanpa bold/stroke, diapit garis putus; ada “= = = =” setelahnya */
    .paid-line{
      display:flex; align-items:center; justify-content:center;
      gap:8px; margin:8px 0; font-weight:400; letter-spacing:.35rem; color:#5a5a5a;
      -webkit-text-stroke:0; text-shadow:none;
    }
    .paid-line::before, .paid-line::after{
      content:""; flex:9; height:1px;
      background: repeating-linear-gradient(to right, var(--line) 0 10px, transparent 8px 14px);
    }

    /* tanggal & catatan PPN kecil */
    #footDate{ font-size:.85rem; }
    .ppn-note{ font-size:.82rem; }

    @media print{
      body{ background:#fff; padding:0 }
      .builder{ display:none !important }
      .receipt{ border-radius:0; box-shadow:none }
      .rule, .rule--mini, .rule-strong, .rule-equals, .rule-solid{
        -webkit-print-color-adjust: exact; print-color-adjust: exact;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- ====== FORM BUILDER ====== -->
    <div class="builder">
      <h3 style="margin:0 0 8px">Pembuat Struk</h3>
      <div class="row">
        <div><label>Nama Toko</label><input id="toko" value="ALFAMART"></div>
        <div><label>Cabang/Area</label><input id="cabang" value="JELINDRO SAMBI K SBY"></div>
        <div><label>No. Toko</label><input id="telepon" value="081380746865"></div>
      </div>
      <div class="row">
        <div><label>Alamat 1</label><input id="alamat1" value="JL. JELIDRO NO 107 - SAMBIKEREP"></div>
        <div><label>Alamat 2</label><input id="kota" value="SAMBIKEREP, SAMBIKEREP"></div>
      </div>
      <div class="row">
        <div><label>Alamat 3</label><input id="alamat3" value="JL. JELIDRO NO 107"></div>
        <div><label>Ongkir (Rp)</label><input id="ongkir" type="number" value="0" oninput="render()"></div>
      </div>

      <div class="rule"></div>

      <!-- Hanya varian + qty + harga -->
      <h4 style="margin:0 0 6px">Tambah Produk</h4>
      <div class="row">
        <div>
          <label>Varian</label>
          <select id="variant">
            <option>SunCo Minyak Goreng Pouch 2 L</option>
            <option>UBM Crackers Krim 350 g</option>
            <option>L-Men Protein Bar Cokelat 22 g</option>
            <option>SilverQueen Cokelat Susu Batang Cashew 55 g</option>
            <option>NyamNyam Fantasy Stick Stroberi 25 g</option>
            <option>Dua Kelinci Tic Tac Pilus Mix 80 g</option>
            <option>Dua Kelinci Tic Tac Pilus Sapi Panggang 80 g</option>
            <option>Dua Kelinci Tic Tac Pilus Mie Goreng 80 g</option>
            <option>Dua Kelinci Tic Tac Pilus Rumput Laut 80 g</option>
            <option>Dua Kelinci Tic Tac Pilus Pedas 80 g</option>
            <option>Dua Kelinci Tic Tac Pilus Ayam Bawang 80 g</option>
            <option>Dua Kelinci Tic Tac Pilus Original 80 g</option>
          </select>
        </div>
        <div><label>Qty</label><input id="pqty" type="number" min="1" value="1"></div>
        <div><label>Harga Satuan (Rp)</label><input id="pprice" type="number" min="0" value="0" placeholder="contoh: 43500"></div>
        <div style="display:flex;align-items:flex-end;gap:.5rem;flex-wrap:wrap">
          <button class="btn" onclick="addItem()">Tambah</button>
          <button class="btn secondary" onclick="clearForm()">Reset</button>
          <button class="btn danger" onclick="resetAll()">Bersihkan</button>
        </div>
      </div>

      <div class="rule"></div>

      <div class="row">
        <div><label>Total Diskon (Rp)</label><input id="diskon" type="number" value="0" oninput="render()"></div>
        <div><label>Voucher (Rp)</label><input id="voucher" type="number" value="0" oninput="render()"></div>
      </div>

      <div style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn" onclick="window.print()">Print / Simpan PDF</button>
        <button class="btn secondary" onclick="downloadStruk()">Download Struk (PNG)</button>
      </div>
    </div>

    <!-- ====== PREVIEW STRUK ====== -->
    <div class="receipt" id="receipt">
      <div class="rcp">
        <div class="logo"><img src="img/logo.jpg" alt="Alfamart"></div>

        <div class="hdr-line">
          <div class="left">Pickup at :</div>
          <div class="right muted" id="pickupBlock"></div>
        </div>

        <div class="rule"></div>

        <div class="hdr-line">
          <div class="left"></div>
          <div class="right muted" id="datetime"></div>
        </div>

        <div class="rule"></div>

        <div class="hdr-line">
          <div class="left">Status Order :</div>
          <div class="right" style="color:var(--accent);font-weight:600">Selesai</div>
        </div>


        <div class="center muted" id="storeBlock"></div>

        <!-- Garis “= = = =” di atas Ref -->
        <div class="rule-equals"></div>

        <div class="muted">Ref. <span id="refBlock"></span></div>

        <!-- Garis “= = = =” di bawah Ref -->
        <div class="rule-equals"></div>

        <!-- Items -->
        <table>
          <thead>
            <tr>
              <th class="name"></th>
              <th class="qty"></th>
              <th class="price"></th>
              <th class="total"></th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
        </table>


        <!-- Ringkasan -->
        <table class="sum" id="sumTable"></table>

        <p class="muted ppn-note" style="margin-top:4px">*Harga yang tertera sudah termasuk PPN</p>

        <!-- Garis putus, LUNAS, lalu garis “= = = =” -->
     
        <div class="paid-line">L U N A S</div>
        <div class="rule-equals" style="margin:6px 0;"></div>

        <div class="muted center" id="footDate"></div>

        <div class="rule-strong"></div>
        <div class="center muted">Kritik &amp; Saran: 1500959</div>
        <div class="center muted">Email: alfacare@sat.co.id</div>

        <div class="rule-solid"></div>
      </div>
    </div>
  </div>

  <script>
    const items = [];

    // Format 43,500
    function rupiah(n){ return (Math.round(n)||0).toLocaleString('en-US'); }

    // Ref: S-YYMMDD-XXXXXX
    function genRef(){
      const d = new Date();
      const pad = x => String(x).padStart(2,'0');
      const y = d.getFullYear().toString().slice(-2);
      const m = pad(d.getMonth()+1);
      const dd = pad(d.getDate());
      const letters = Array.from({length:6},()=> String.fromCharCode(65+Math.floor(Math.random()*26))).join('');
      return `S-${y}${m}${dd}-${letters}`;
    }

    // Tanggal header: Senin, 04 Agustus 2025 (sesuai saat generate)
    function tanggalID(d){
      const days=['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
      const months=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
      const pad = x => String(x).padStart(2,'0');
      return `${days[d.getDay()]}, ${pad(d.getDate())} ${months[d.getMonth()]} ${d.getFullYear()}`;
    }

    // Slot pickup: 2 jam dari sekarang, minimal mulai 08:00
    function pickupInfo(){
      const d = new Date();
      const pad = x => String(x).padStart(2,'0');
      let startH = Math.max(d.getHours(), 8);
      let endH   = Math.min(startH + 2, 23);
      return { tgl: tanggalID(d), slot: `${pad(startH)}:00 - ${pad(endH)}:00` };
    }

    // Tambah item (varian + qty + harga)
    function addItem(){
      const name = document.getElementById('variant').value;
      const qty  = parseInt(document.getElementById('pqty').value||'0',10);
      const price= parseInt(document.getElementById('pprice').value||'0',10);
      if(!name || qty<=0 || price<0) return;
      items.push({name, qty, price});
      clearForm(); render();
    }
    function clearForm(){
      document.getElementById('variant').selectedIndex = 0;
      document.getElementById('pqty').value = 1;
      document.getElementById('pprice').value = 0;
    }
    function resetAll(){
      items.length=0;
      document.getElementById('diskon').value=0;
      document.getElementById('voucher').value=0;
      document.getElementById('ongkir').value=0;
      render();
    }

    function render(){
      const p = pickupInfo();
      document.getElementById('pickupBlock').innerHTML =
        `${document.getElementById('cabang').value}<br>${document.getElementById('alamat1').value}`;
      document.getElementById('datetime').innerHTML = `${p.tgl}<br>${p.slot}`;

      document.getElementById('storeBlock').innerHTML =
        `${document.getElementById('cabang').value}<br>${document.getElementById('telepon').value}<br>${document.getElementById('kota').value}<br>${document.getElementById('alamat3').value}`;

      if(!render._ref) render._ref = genRef();
      document.getElementById('refBlock').textContent = render._ref;

      // Items
      const tbody = document.getElementById('itemsBody');
      tbody.innerHTML = '';
      let subtotalQty = 0, subtotal = 0;

      items.forEach(it=>{
        const line = it.qty * it.price;
        tbody.insertAdjacentHTML('beforeend', `
          <tr>
            <td class="name">${it.name}</td>
            <td class="qty">${it.qty}</td>
            <td class="price">${rupiah(it.price)}</td>
            <td class="total">${rupiah(line)}</td>
          </tr>
          <tr><td colspan="4"><div class="rule--mini"></div></td></tr>
        `);
        subtotalQty += it.qty;
        subtotal += line;
      });

      const diskonVal  = parseInt(document.getElementById('diskon').value  || '0', 10);
      const voucherVal = parseInt(document.getElementById('voucher').value || '0', 10);
      const ongkirVal  = parseInt(document.getElementById('ongkir').value  || '0', 10);
      const total = subtotal - diskonVal - voucherVal + ongkirVal;

      document.getElementById('sumTable').innerHTML = `
        <tr><td class="lbl">Subtotal</td><td class="qty">${rupiah(subtotalQty)}</td><td class="amt">${rupiah(subtotal)}</td></tr>
        <tr><td class="lbl">Total Diskon</td><td></td><td class="amt">(${rupiah(diskonVal)})</td></tr>
        <tr><td class="lbl">Voucher</td><td></td><td class="amt">(${rupiah(voucherVal)})</td></tr>
        <tr><td class="lbl">Biaya Pengiriman</td><td></td><td class="amt">${rupiah(ongkirVal)}</td></tr>
        <tr><td class="lbl">Total</td><td></td><td class="amt">${rupiah(total)}</td></tr>
      `;

      const d=new Date(), pad=x=>String(x).padStart(2,'0');
      document.getElementById('footDate').textContent =
        `Tgl. ${pad(d.getDate())}-${pad(d.getMonth()+1)}-${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    // Pastikan semua garis ikut saat download PNG
    function downloadStruk(){
      const target = document.getElementById('receipt');
      target.style.webkitPrintColorAdjust = 'exact';
      target.style.printColorAdjust = 'exact';
      html2canvas(target, {
        scale: Math.max(2, window.devicePixelRatio || 2),
        backgroundColor: "#fff",
        useCORS: true,
        imageTimeout: 0,
        logging: false
      }).then(canvas=>{
        const link=document.createElement('a');
        link.download='Struk_Alfamart.png';
        link.href=canvas.toDataURL('image/png');
        link.click();
      });
    }

    ['toko','cabang','telepon','alamat1','kota','alamat3'].forEach(id=>{
      document.getElementById(id).addEventListener('input', render);
    });

    render();
  </script>
</body>
</html>
